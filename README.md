
Nanogpt

这是用于训练/微调中等规模 GPT 的最简单、最快的仓库。它是 minGPT 的重写版本，优先考虑功能性而非教学。目前仍在积极开发中，但目前 train.py 文件可以在 OpenWebText 上重现 GPT-2（124M），在单个 8XA100 40GB 节点上训练约 4 天。代码本身非常简洁可读：train.py 是一个约 300 行的训练循环模板，model.py 是一个约 300 行的 GPT 模型定义，您可以选择加载 OpenAI 的 GPT-2 权重。
由于代码非常简单，很容易根据需要进行修改，可以从头开始训练新模型，或微调预训练的检查点（例如，当前可用的最大模型是 OpenAI 的 GPT-2 1.3B 模型）。

安装

pip install torch numpy transformers datasets tiktoken wandb tqdm

要求

·pytorch <3

·numpy <3

·transformers 用于 Huggingface 的 transformers <3（加载 GPT-2 检查点）

·datasets 用于 Huggingface 的 datasets <3（如果你想下载+预处理 OpenWebText）

·tiktoken 用于 OpenAI 的快速 BPE 代码 <3

·wandb 用于可选的日志记录 <3

·tqdm 用于进度条 <3


快速开始

如果您不是深度学习专家，只是想感受魔力并入门，最快的方式是用莎士比亚作品训练一个字符级别的 GPT。首先，我们将其下载为一个单独的（1MB）文件，并将其从纯文本转换为一个大的整数流：

python data/shakespeare_char/prepare.py

这将在该数据目录中创建 train.bin 和 val.bin。现在是训练 GPT 的时候了。模型的大小取决于您的计算资源。

如果你有GPU，我们可以使用 config/train_shakespeare_char.py 中提供的设置快速训练一个小型 GPT。

python train.py config/train_shakespeare_char.py

如果你有CPU，但没有GPU，你可以尝试用相同的配置进行训练，只需将批量大小减小一点并运行。

python train.py config/train_shakespeare_char.py --device=cpu --batch_size=32

请注意，训练时间会显著增加，但你仍然可以体验整个过程

训练 GPT-2

如果你是一名深度学习从业者或对更大的 GPT 感兴趣，你可以尝试在 OpenWebText 上重现 GPT-2 (124M)。首先，下载并准备数据集：

python data/openwebtext/prepare.py

然后运行训练脚本：

python train.py config/train_gpt2.py

这将使用大约 2GB 的显存来训练 GPT-2（124M），但也可以在多 GPU 上进行扩展，或使用混合精度训练以节省内存。config/train_gpt2.py 中的配置文件可以根据你可用的计算资源调整。

进阶用法

对于高级用户或希望进行自定义训练的开发者，train.py 和 model.py 中的代码非常简洁易懂。你可以轻松修改模型结构、数据预处理步骤或训练循环。例如，想要加入额外的特征或尝试其他优化算法都十分方便。

项目当前的改进和待完成任务包括：

研究并引入 FSDP 代替 DDP

在标准评估集（如 LAMBADA 或 HELM）上进行零样本困惑度评估

调整微调脚本，优化超参数

训练过程中增加批量大小的线性计划

集成其他嵌入技术（如旋转嵌入、alibi）

从模型参数中分离出优化器缓冲区

增加关于网络健康状况的日志记录（如梯度裁剪事件、梯度幅度）

进一步优化模型初始化方法等

生成文本

 他轻轻一挥手，一道又一道剑芒飞出，一条条法则交织，这是天道法则，密布在虚空中，展现出了狂暴的力量。
 
    “砰”
    叶凡以拳头打了过去，金色血气冲天，全都发出的光华，如一个彗星撞击而过，但却挡不住。
    “当”
    叶凡大手印，印还有山河声，一下子打的天塌地陷了，可是这一击却被打的不成样子，且将这位强大的肉身震飞了出去。
    “砰”
    大岳如山，压落的大岳，让虚空都崩碎了，被震的不成样子。
    “砰”
    叶凡大印化成的宝印，将他抽飞了出去，那座山峰被他震飞了出去，真打的叶凡被打的骨断筋折。
    “砰”、“砰”……叶凡如一尊大岳一样压了下来，让所有人都大口咳血，骨头接连四分五裂，紫血冲起三千丈高，这恐怖的力量，让他很难受。
    “啪”、“啪”……这一次，叶凡连续拍击，将虚空都压的塌陷了下去，他的肉身像是一尊神明，一下子咳出了一口血，倒飞了出去。
    “噗”
    叶凡浑身为金色毛发的血液，冲了出去，右手化成了金色的天碑，轰的一声将两人洞穿，血肉横飞。
    “你……”
    “这是什么人，就是你！
---------------
    叶凡双目神光湛湛，射出两道神光，而后以他的神识攻击，一道炽盛的黄金芒将姬皓月倒飞了出去，眉心裂开一道缝隙。
    “老祖出手了，真是让人吃惊。”姬紫月倒退，她知道这是什么体质，为何这么做？
    “天啊，竟然是他，好强大，竟然被封印了，真是胆大包天！”涂飞吃惊，他是因为对方竟有这样的玄法，体内像是有一尊神祗，倒像是有什么东西在阻挡。
    “天啊，怎么可能！”
    叶凡闻言，心中惊讶。
    “这是……”
    “天啊，这是一个神秘强者的体现，竟然出现了！”
    “紫山中的那位天才，竟然是这个恐怖的神体！”
    所有人都震惊，有人这样的神体可谓吓人，简直难以相信。
    “他是我的鼎，是紫山中部地域的遗留，我竟然失传了中皇的真经。”
    “能不能让其破开，他还没有修炼吗？”
    “不能吧，我不能将它收进鼎，不能进入这个境界，将其救活。”
    “这样做？”
    “不对，这个神秘的世界有不可思议的大造化，谁能争锋？！”
    “他拥有大帝神体，独掌诸天，诸子齐出，谁能破解？”
    “不错，这是一件无上神物
---------------
    “轰”
    一座黑山破碎了，根本不能阻止他接近，它也沉入了进去，即将消失。
    叶凡心中一动，他想到了很多，圣崖上出了一些传说，不然不可能有大麻烦。
    不过，越看越觉得有些荒的力量越强大，且若是有神力，他也无法探索，如何对抗？
    “轰”
    远处，那座山峰不断摇动，生命精气都弥漫了出来，像是有数不清的生命精气在喷涌。
    “终于有人来到了此地，这里是与绝顶大能的结合，我们有多远给我们机会的感觉。”
    “我来到了这里。”
    “那是……”
    “什么？”
    ……那些强大的修士全都睁大了眼睛，终于知道那些人是否真的要出现了，不过这个时候很危险。
    深渊上，垂落下一道又一道道纹丝绦，但却不能通过，只是这种消耗太多了，他们才能确定下来。
    “这里……为什么？”很多人都露出惊容，皆露出不解之色。
    “这是……”
    “道纹，这是‘道纹’的一个世界，不仅仅有诸多‘道纹’，还有其他奥义，还可以困住道宫秘境的修士。”
    “这怎么可能，阵纹怎么消失？”
    ““这座道宫秘境……”叶凡心
---------------
    “小友，你们认为是否定了这个世界？”一个老者盯着那颗大星，神色难看到了极点，没有多说什么。
    叶凡一声轻叹，道：“我知道这个世界传说有神话传说中的存在，不知道有谁能说清。”
    “不可能，也许真的是神话时代的人！”另一位老者震撼无比。
    在接下来的几天里，叶凡眉心的金色小人，一缕缕金色的血气化成了一道可怖的闪电，接连就演出了五域！
    然而，在在此期间，叶凡手中出现一尊金色的小人，手持打神鞭，与他的肉身一起对抗，发出了一片炽盛的光，且若真实的神凰，璀璨夺目。
    “当！”
    叶凡的金色小人抱着一颗红色的大星，一只大手将其击了出去，与那株古木撞在一起，发出一声震天巨响，神光烁天。
    这是一场大战，两人打的同时，叶凡体内的血液飞溅，他感觉像是有一尊小太阳在燃烧，内部的血液在沸腾，在这一刻全面爆发。
    “当！”
    一声巨响，叶凡挥动六道轮回拳，击出了惊世攻击，与那不光的金色小人碰撞在一起，发出了冲霄的光芒。
    然而，这个人却是没有敢撄锋，金色的拳头从天而降，将这片地方淹没了，他发出了摧枯拉朽的打神鞭，一拳轰在
---------------
    这是一个特别的世界，并非几个圣地与天璇圣地的神土，而是一处神圣之地，名为姜家的一处圣地。
    姜家、摇光、姜家、姜家、摇光圣地、姜家、姜家、摇光圣地、姜家神体、姜家、姜家、摇光圣地，将成为天下最强大的传承。
    一个圣地、诸多大势力也不过是被惊动了，他们同样的人也来了，未敢涉足“道”，因为对于很多人来说，很多人都不知道会发生什么。
    “走，去姜家的姜族，若是在此地，北域我帮你们突破！”
    姜逸飞、姜怀仁、姜怀仁、柳寇、姜逸飞、李黑水等全都心中凛然，没有想到，姜家的人要将这里彻底杀个干净。
    “刷”
    光芒一闪，姜家的人出现，快速消失三个月了。
    “姜逸晨不认识吧，他必然是来了，等你们到了！”
    “姜家的人得到消息，确定是摇光圣地的人，他们没有在此地。”
    “他们是姜家的底蕴？！”
    “没有人敢对他们动手，我们必须要出现。”
    ……姜逸晨神色平静，自从来没有像今天这样的可怕事情了，所有人都知道，绝对恐怕会不会有错。
    “是他们姜家的人，刚才听说了他们的音波，就是这样的回应，说不定会是那个
---------------
    “噗”
    一声轻响，那名绝顶大能当场崩碎，口中喷血，当场化成了泥水，形神俱灭。
    “你……”
    远处，十几名大能惊惧，化龙池内的人全都变色，被这个活化石的修士一击毙命，这还怎么打？
    “咚！”
    叶凡将大黑狗的神念催动了出去，一下子就将这个干净了。
    “轰！”
    与此同时，黑色的大地震动，如一片黑色的大地一样，隆隆作响，如潮汐一样汹涌。
    “咚！”
    十几名圣主级人物大喝，他们的身体冲出一道道乌光，一下子将虚空禁锢了。
    “砰！”
    叶凡一脚将碎片染血的铜炉打了进去，只留下一个血盆大口，将他们吞没了进去。
    “噗”
    鲜血喷涌，每一个人都被打中，鲜血染红了地上，这根本没有生命的希望，他被毁在了里面。
    “怎么会这样？！”
    “绝世恐怖的存在，有几人能杀死人！”
    “杀，他们都说叶凡了，也比杀了这个恐怖的人物，真是让人难以置信。”
    这些人非常恐怖，但却没有任何话语，一个个都是王者啊，一个比一个让人生畏。
    “杀！”
    黄金战船
---------------
    “你是来自四极秘境的修士？”
    “青蛟王的长老，都已经死去多年了，还没有出现过一个圣地，你们的圣子与圣女又如何？”青蛟王淡淡的笑着。
    “不对，只有一个人可以活下来，是这些圣子级人物，不可能与圣地比肩，但却多半是逼我们大战了。”青蛟王冷声道。
    “此人不是早已死去多年了，青蛟王也在秦岭，他们不过是为了活命而来而已，你拿什么来换？”颜如玉开口。
    叶凡没有多说什么，持金色的大钟，依然镇定而下，道：“你可从来没有遇到过这样的东荒人，就不怕你们自己来吗？”
    “你我不相信……”秦瑶平静的笑了笑，但却让叶凡心中多少有些吃惊。
    “你要是知道他们是谁，如果你得到了青蛟王之秘，我们也不会告诉我，你们觉得你会去北域撒野？”青蛟王冷笑道。
    “自古以来，谁是他，自然会不会说是他的对手。”叶凡平静的说道。
    “古来大能，每一个人都有自己的名字，不知道他们的传说，若是想杀人，可以揭开青蛟王的门槛才能否为真。”青蛟王冷淡的说道。
    大战停下，叶凡与涂飞都很不平静，没有任何顾忌，他们已经到了青蛟王的近前，纵然是金翅小鹏王也心中震撼
---------------
    “老朽都死，你们还清醒吧，我们在等你们，若是没有人活下来，就会死的！”
    姜家的人震怒，这是何等的大人物？不少人都化成了人形，一个个都不是很强大的人物，全都被一个老老妖孽逼到脸上了，根本就没有办法活了。
    地宫中，众人更是震撼了，姜家不仅露出这样的神色，还有这样的实力，还有谁敢冒犯者？
    “老梆子，我们还是来杀我们，留下来吧，就杀了几个老妖孽，到底是谁？”姜家的年轻人莫不大喝。
    “轰！”
    绝世老妖孽级人物出手，一下子将这位大能的凶兵阻挡住了，不敢硬撼了。
    “姜太虚你可真是大胆，不过如此胆大包天，敢来我姜家撒野，不知死活！”
    “同样与我们也不会知晓，你们这样的大教都不如从前了，自己不怕吗？！”
    叶凡没有答应，他可是一个活了两千多岁的老妖孽，怎么可能活到现在，一个人怎么可能会如此？
    “姜太虚你还是给我去死！”
    “这个老妖孽，真是……”
    “轰！”
    地宫中，一位大能小心惊肉跳，他们的大帝阵纹越来越恐怖，连人世间的人都无法承受他们的威压。
    “当！”
    地宫崩
---------------
    “刷”
    就在这时，叶凡突然一下子消失了，快速归身。
    “你……”姬紫月惊叫。
    “你可是叶凡，可不是你的对手，在此之前只对荒古圣体，这难道是荒古圣体的后人？”姬紫月大眼闪动亮晶晶。
    “不错，是因为你的体质，绝对没有看错，我没有抗衡的只是传言，你的体质很强健。”叶凡微笑。
    “你不是想对我说的。”姬紫月没有多说什么。
    “我连一个自己的弟弟也没有相见，怎么不去了？”姬紫月笑着问道，俏脸颊生辉，小酒窝呈现，很是溺爱的抓住叶凡的手掌。
    “可是，他的状态……”叶凡笑着起来。
    “你想吃了我姬家的圣体，我觉得我很想留下你的性命，不然你不可能会浪费尽心机，就如此，我真的不能强大！”姬紫月眨动大眼，道：“我有秘法，不能让你尽管放弃，但不会有任何危险。”
    “姬家的人请多多带路，出行路是很远，我想办法解开他们的门派，不然的话我不会来此地。”叶凡很想回想，但心中却很不满意。
    “你想做什么？”姬紫月轻笑，道：“我连姬家圣主的弟弟都不知道，你真的要去太玄门，尽可避免我们出手。”
    “你在说什么？”叶凡踱步
---------------
    “这是……”张文昌露出惊讶的神色，上面写满了不解，很是惊讶。
    “这个世上，他居然没有出现过，我想我只听说过……”张文昌露出惊讶的神色，道：“老人家您的意思？”他的心中看到两人的深浅，像是被困在了这里，似乎很难看清。
    “自然明白，这里……”叶凡的心神似乎一震。
    “有什么？”张文昌不解。
    “先说您是不是说你。”
    “不知道后你才是否有那么重要的事情？”叶凡问道。
    “我是说，那是一个普通的青年，我想知道，如果没有修成‘道’的问题，我们已经不是‘道宫’，我无法预料。”是的，叶凡心中充满了疑惑。
    “我……”
    “我……不是想……”
    张文昌伸手向叶凡一下子抓去，用力攥住他的双臂，冷声道：“当然，想要求你不要，我若是想想对你说，我什么也不会如此……”
    “你……”
    叶凡将他扔在地上，道：“不要……”他急忙抓住那个一双大手，而后又痛的坐在了地上。
    “你……你想害死我……”张文昌露出不甘的神色，脸上狰狞，杀机毕露，道：“我不会将你擒住，以后那是我们的姐姐吧，会给你一个好钱的。”
